# 📦 Halo 自动备份与恢复脚本使用指南

本文详细介绍 Halo 自动备份脚本的功能、使用方法及恢复指南，帮助您轻松管理 Halo 应用的数据安全。

## 📋 导航目录

- [📦 脚本概述](#script-overview)
- [✨ 功能特点](#features)
- [🔧 使用方法](#usage)
- [📁 备份原理](#backup-principle)
- [🔄 恢复方法](#restore-method)
- [⚙️ 参数说明](#parameters)
- [💡 注意事项](#notes)

<a id="script-overview"></a>
## 📦 脚本概述

Halo 自动备份脚本是一个专为 Halo 应用设计的数据保护工具，能够自动化完成应用数据的压缩备份、版本管理和旧备份清理工作。通过简单的命令即可实现一键备份，确保您的博客数据安全无忧。

<a id="features"></a>
## ✨ 功能特点

- 🕐 **自动时间戳**：备份文件自动添加精确到分钟的时间戳（halo_YYYYMMDD_HHMM.tar.gz）
- 💾 **智能清理**：自动保留最新的3个备份版本，避免磁盘空间浪费
- ✅ **操作反馈**：实时显示备份进度和结果，提供明确的操作反馈
- 📂 **目录保持**：备份时保留原始目录结构，便于恢复
- 🔄 **简单恢复**：提供完整的恢复命令示例，降低恢复难度

<a id="usage"></a>
## 🔧 使用方法

### 安装与执行
选择以下任一命令即可执行备份脚本：

```bash
# 使用主域名执行
bash <(curl -sL script.meimolihan.eu.org/sh/halo/halo_backup.sh)

# 或使用Gitee镜像执行（国内用户推荐）
bash <(curl -sL gitee.com/meimolihan/script/raw/master/sh/halo/halo_backup.sh)
```

### 执行过程
脚本运行后会显示如下信息：
1. 显示脚本功能和路径信息
2. 创建备份目录（如果不存在）
3. 开始压缩备份并显示进度
4. 清理旧备份文件（保留最新3个）
5. 显示备份结果和当前备份文件列表

<a id="backup-principle"></a>
## 📁 备份原理

### 备份源目录
```
/vol1/1000/compose/halo
```

### 备份目标目录
```
/vol2/1000/阿里云盘/教程文件/Halo/backup/Halo-PostgreSQL
```

### 备份命名规则
采用时间戳格式：`halo_YYYYMMDD_HHMM.tar.gz`  
示例：`halo_20231025_1430.tar.gz`（表示2023年10月25日14点30分的备份）

### 保留策略
脚本会自动管理备份版本，仅保留最新的3个备份文件，较早的备份会被自动删除。

<a id="restore-method"></a>
## 🔄 恢复方法

当需要从备份恢复 Halo 应用时，使用以下命令：

```bash
tar -xzvf /vol2/1000/阿里云盘/教程文件/Halo/backup/Halo-PostgreSQL/halo_20231025_1430.tar.gz -C /vol1/1000/compose/
```

📝 **参数说明**：
- `-x`：解压模式
- `-z`：使用gzip解压缩
- `-v`：显示详细过程
- `-f`：指定备份文件
- `-C`：指定解压目标目录

<a id="parameters"></a>
## ⚙️ 参数说明

脚本中使用的主要变量：

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| `BACKUP_SRC_DIR` | `/vol1/1000/compose` | 备份源目录 |
| `BACKUP_DEST` | `/vol2/1000/阿里云盘/教程文件/Halo/backup/Halo-PostgreSQL` | 备份目标目录 |
| `BACKUP_PREFIX` | `halo` | 备份文件前缀 |
| `TIMESTAMP` | `$(date +%Y%m%d_%H%M)` | 时间戳格式 |

<a id="notes"></a>
## 💡 注意事项

1. 📂 **目录权限**：确保运行脚本的用户对源目录有读取权限，对目标目录有写入权限
2. 💾 **磁盘空间**：确保目标分区有足够的存储空间存放备份文件
3. ⏰ **执行频率**：建议根据博客更新频率设置合理的备份计划（如通过cron定时任务）
4. 🔒 **数据安全**：重要数据建议采用多地备份策略，不要依赖单一备份
5. ✅ **恢复测试**：定期测试备份文件的可用性，确保需要时能够正常恢复

---

> 🚀 定期备份是数据安全的重要保障，建议您设置定时任务自动执行此脚本，为您的Halo博客提供持续的数据保护。